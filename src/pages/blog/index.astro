---
// Blog Index Page
// ------------
// Description: The blog index page.

// Components
// - Layout
import Layout from '../../layouts/Layout.astro'
// - UI
import Hero from '../../components/blocks/hero/PageHeader.astro'
import BlogPosts from '../../components/blocks/blog/BlogPosts.astro'

// WordPress GraphQL Client
import WordPressGraphQLClient from '../../lib/wordpress.js'

// Define types for WordPress post data
interface WordPressPost {
  slug: string;
  title: string;
  excerpt: string;
  date: string;
  featuredImage?: {
    node?: {
      sourceUrl?: string;
    };
  };
  author?: {
    node?: {
      name?: string;
    };
  };
  categories?: {
    nodes?: Array<{
      name: string;
    }>;
  };
}

// Define type for paginate function parameter
interface PaginateParams {
  paginate: any;
}

// Content
// - SEO
const SEO = {
	title: 'WCH Learn | Latest WCH Health & Wellness News, Articles, and Resources',
	description:
		"Explore the latest news, articles, and resources from WCH Health & Wellness. Stay informed and stay healthy with WCH Learn."
}
// - Page Header
const header = {
	title: 'The <strong>WCH Learn</strong> Blog. News, Articles, and Resources',
	text: 'Stay informed and stay healthy with WCH Learn.'
}

// Fetch posts from WordPress
const client = new WordPressGraphQLClient();
const response = await client.getAllPosts(12);
const allPosts = response.posts.nodes.map((post: WordPressPost) => ({
  id: post.slug,
  data: {
    title: post.title,
    description: post.excerpt.replace(/<\/?[^>]+(>|$)/g, ""), // Strip HTML
    pubDate: new Date(post.date),
    image: post.featuredImage?.node?.sourceUrl || '/placeholder-image.jpg',
    author: post.author?.node?.name || 'WCH Team',
    tags: post.categories?.nodes?.map((cat: { name: string }) => cat.name) || []
  }
}));

export const getStaticPaths = async ({ paginate }: PaginateParams) => {
  return {
    // Your paths here
    revalidate: 3600 // Revalidate every hour
  };
};

// Enable static rendering
export const prerender = true;
---

<Layout title={SEO.title} description={SEO.description}>
	<Hero title={header.title} text={header.text} />
	<BlogPosts data={allPosts} />
</Layout>

<meta http-equiv="refresh" content="0;url=/blog/1" />
